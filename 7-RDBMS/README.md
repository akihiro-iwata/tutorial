# RDBMS
Relational DataBase Management Systemとは、Relational DataBaseを管理するためのシステム・ソフトウェアである。  
代表的なものとして、Oracle Database, Microsoft SQL Server, MySQL, PostgreSQL, IBM DB2等が挙げられる。  

一般的に、企業は基幹システム等を通して、以下のデータを保全・管理する必要がある。 

- マスターデータ:  
  企業内データベースなどで、業務を遂行する際の基礎情報となるデータのこと。  
  また、それらを集約したファイルやデータベースのテーブルなど。単に「マスタ」と省略するのが一般的である
  - 商品マスタ 
  - 取引先マスタ
  - 従業員マスタ
  - 組織マスタ
  - 勘定項目マスタ

- トランザクションデータ:  
  企業の情報システムなどが扱うデータの種類の一つで、業務に伴って発生した出来事の詳細を記録したデータのこと。  
  “transaction”とは「(商)取引」の意味で、顧客との間の商品の受発注や支払い、納品などを記録したものをトランザクションデータということが多い。  
  その場合、いつ、誰に、何を、何個売り、代金はいくらで、いつ納品で、いつ支払いか、などの情報を時系列に記録する。  
  また、これに加え、購買や生産、社員への給与の支払い、経費の精算などに関する出来事の記録を含める場合もある。
  - 販売実績データ
  - 給与支払い履歴データ
  - 購買履歴データ

これらのデータをRDBMSではなくExcelやCSV、あるいは手書きの台帳で管理することは可能である。  
RDBMSが必ずしも優れたデータ保全管理のソリューションではない。RDBMSが持つメリットは、以下のようなものが挙げられる。

- トランザクション処理  
  ※トランザクションデータの「トランザクション」とは意味が異なる  
  既知の一貫した状態のデータベースを維持するよう設計されており、相互依存のある複数の操作が全て完了するか、全てキャンセルされることを保証する。

- 整合性制約  
  ある属性に対して制約を設けることで、誤ったデータが保存されることを防止する。  
  ex.) 存在しない従業員IDを持つ社員データ、氏名を持たない社員データ  
  ※ 何を以て「誤った」データと判断するかは、要件によって異なる。

## テーブル構造を理解する
『RDBの寿命はアプリケーションより長い』(http://soudai.hatenablog.com/) というフレーズがある。  
アプリケーションはサービスの成長やビジネス環境の変化に伴う仕様変更、機能追加等の様々な理由で変化する。  
機能が増えればテーブルが増えることもある。しかしこうした変更は金銭的または時間的制約によって、局所解に陥いることがしばしば発生する。  
これが10年、20年、30年と積み重なり、テーブル構造は複雑化していき、リファクタリングがますます難しくなっていく。
テーブル構造を理解する、というのはゼロからこれを設計するというよりは、こうした複雑化した設計の中で最適なSQLをどのように書いていくかというスキルで重要になる。(当然、ゼロから設計するときも必要ではあるが)  

### SQLを書くときに考える事
筆者が考えることを以下に記載する。  
なおいくつかはSQLアンチパターン(https://www.oreilly.co.jp/books/9784873115894/）という書籍から影響を受けたものである。  

- そのSQLは一時的に使うものか、バッチ処理か、オンライン処理か  
  そのSQL自体の使い方によってまず考えることが変わる。
  
  - 一時的に使う…多くの場合はデータ抽出やテスト等の目的で行う。
                ログインするユーザーは必要最低限の権限を持ったものにする。
                
  - バッチ処理…扱うデータ件数が100万等、膨大な数になりがち。
              SQLアンチパターンのSpaghetti Queryになろうがパフォーマンスを優先する。
              SQLでデータを取って、それを変換して、INSERTするという処理が浮かんだら、それをJOINなどを使って1本のSQLで完結させることを考える

  - オンライン処理…大容量データを一度に処理することは少ない。(そのような仕様や設計を認めてはいけない)
                  SQLが得意なJOIN,GROUP BY等のデータ非正規化処理と、JavaやPHPといった言語が得意な集計処理のそれぞれを使いわける
                  空文字/0/nullの扱いに要注意、LEFT OUTERを用いるときはnullが発生するケースを必ずテストする

- 実行計画の見方、読み方を知る  
  **憶測で無闇にパフォーマンス最適化を求めない**

- 外部キー制約を使う
  「アプリケーション側でデータ整合性は取ってるから外部キーは要らない」というのは理由にならない  
   外部キー制約によるデータ整合性担保は**データ整合性を壊すほうが難しい**環境を作るためのもの
   アプリケーションのバリデーションは努力目標でしかない、またパフォーマンスが外部キー起因で遅くなるというのはほぼジンクス
   実行計画の見方を覚えるとここで有利

- JOINを効率的に使う
  WHERE INやEXISTS句が頭に浮かんだときに、JOINで代替することを考える
  ※EXISTSとJOINはそれぞれどちらが早くなるか一概には言えないため、要注意

- Where句の中身がINDEXを使えるか
  LIKEやNULL比較、INやORはINDEXが効かない場合はあるため、要注意
  ただしここでも無闇に禁止するのではなく、実行計画を見る
  
## MySQLのインストール
MySQLはOSSで開発されているRDBMSの一種である。GNU GPLライセンスであるため、フリーで使用することができる。  
ここでは学習用のRDBMSとしてMySQLを用いる。  

### Exercise
- LinuxへMySQLをインストールしてください  
  多くの場合、`apt-get`や`yum`等のパッケージマネージャを用いることでインストールすることができます。 

- `create database`句を用いて、`myblog_db`データベースを作成してください。  
  参考: http://ksino.hatenablog.com/entry/2016/11/17/232619

## RDBMSのデータ操作
RDBMSは**SQL**を用いてデータ操作を行なう。SQLとはStructured Query Languageの略称である。SQLの規格はISOとして標準が定められており、RDBMSの開発ベンダーはこれを基にしている。  
ただし各種RDBMSによってSQLの記法や操作には違いがあることを留意する必要がある。  

### データ定義(DDL: Data Definition Language)
- CREATE  
  新しいテーブル、リレーショナル、ビュー、インデックス等を作成する

- DROP  
  テーブル、リレーショナル、ビュー、インデックス等を削除する

- UPDATE
  テーブル、リレーショナル、ビュー、インデックス等を更新する

#### Exercise
- 以下の属性を持つテーブルを作成してください。  
  - articleテーブル  
    - id(interger,8桁)
    - author(interger,8桁)
    - text(varchar,4000字)
  - Authorテーブル
    - id(interger,8桁)
    - name(name,100字)
    - address(varchar,200字)

### データ操作(DML: Data Manipulation Language)

### データ制御(DCL: Data Control Language)

#### Execise

### PHPとSQLを用いたデータ操作

#### php_pdo

## エンティティとリレーショナル

